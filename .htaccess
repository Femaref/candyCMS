#Options +FollowSymLinks
RewriteEngine On

#-------------------------------------------------------------------------------
# REDIRECT FORM IMAGES/ FOLDER TO PUBLIC/IMAGES FOLDER
#-------------------------------------------------------------------------------
RewriteRule ^favicon.ico$ public/favicon.ico [L]
RewriteRule ^robots.txt$ public/robots.txt [L]

#-------------------------------------------------------------------------------
# SIMPLE, MOST USED RULES
#-------------------------------------------------------------------------------
RewriteRule ^About$ index.php?section=content&id=3 [L]
RewriteRule ^Blog$ index.php?section=blog [L]
RewriteRule ^Contact$ index.php?section=mail&id=1 [L]
RewriteRule ^Content$ index.php?section=content&action=overview [L]
RewriteRule ^Disclaimer$ index.php?section=content&id=1 [L]
RewriteRule ^Gallery$ index.php?section=gallery&action=overview [L]
RewriteRule ^Help/BB-Code$ http://wiki.github.com/marcoraddatz/candyCMS/bb-code [L]
RewriteRule ^Help/FAQ$ index.php?section=content&id=4 [L]
RewriteRule ^Help/Registration$ index.php?section=content&id=2 [L]
RewriteRule ^Impressum$ index.php?section=content&id=1 [L]
RewriteRule ^Invite$ index.php?section=session&action=invite [L]
RewriteRule ^Login$ index.php?section=session&action=create [L]
RewriteRule ^Logout$ index.php?section=session&action=destroy [L]
RewriteRule ^Media$ index.php?section=media [L]
RewriteRule ^Newsletter$ index.php?section=newsletter [L]
RewriteRule ^Register$ index.php?section=user&action=create [L]
RewriteRule ^RSS$ index.php?section=rss [L]
RewriteRule ^Start$ index.php?section=blog [L]
RewriteRule ^User$ index.php?section=user&action=overview [L]
RewriteRule ^User/Settings$ index.php?section=user&action=update [L]

#-------------------------------------------------------------------------------
# COMLICATED ENTRIES TO AVOID PROBLEMS WITH RULES BELOW
#-------------------------------------------------------------------------------
RewriteRule ^Blog/create/([a-z]+)$ index.php?section=blog&action=create&mode=$1&page=1 [L] #CREATE WRITE MODE
RewriteRule ^Blog/update/([A-Za-z0-9]+)/([a-z]+)$ index.php?section=blog&action=update&id=$1&mode=$2&page=1 [L] #EDIT WRITE MODE
RewriteRule ^Content/update/([A-Za-z0-9]+)/([a-z]+)$ index.php?section=content&action=update&id=$1&mode=$2&page=1 [L] #EDIT WRITE MODE
RewriteRule ^CreateComment/([a-z])/([0-9]+)$ index.php?section=comment&action=create&parentcat=$1&parentid=$2 [L]
RewriteRule ^DestroyComment/([0-9]+)/([0-9]+)$ index.php?section=comment&action=destroy&id=$1&parentid=$2 [L]

#-------------------------------------------------------------------------------
# SIMPLER ENTRIES, MOST USED FOR PERFORMANCE REASONS FIRST
#-------------------------------------------------------------------------------
RewriteRule ^Blog/([0-9]+)$ index.php?section=blog&id=$1&page=1 [L]
RewriteRule ^Blog/([0-9]+)/(.*)$ index.php?section=blog&id=$1&page=1 [L]
RewriteRule ^Blog/page/([0-9]+)$ index.php?section=blog&page=$1 [L]
RewriteRule ^Comment/([A-Za-z]+)/([0-9]+)/page/([0-9]+)$ index.php?section=comment&action=show&parentcat=$1&id=$2&page=$3&ajax=1 [L]
RewriteRule ^Contact/(.*)$ index.php?section=mail&id=1&subject=$1 [L]
RewriteRule ^Content/([0-9]+)$ index.php?section=content&id=$1 [L]
RewriteRule ^Content/([0-9]+)/(.*)$ index.php?section=content&id=$1 [L]
RewriteRule ^Gallery/([0-9]+)$ index.php?section=gallery&id=$1&page=1 [L]
RewriteRule ^Gallery/([0-9]+)/page/([0-9]+)$ index.php?section=gallery&id=$1&page=$2&ajax=1 [L]
RewriteRule ^Lang/([a-z]+)$ index.php?lang=$1 [L]
RewriteRule ^Login/([a-z]+)$ index.php?section=session&action=$1 [L]
RewriteRule ^Mail/([0-9]+)$ index.php?section=mail&id=$1 [L]
RewriteRule ^Newsletter/([a-z]+)$ index.php?section=newsletter&action=$1 [L]
RewriteRule ^RSS/([a-z]+)$ index.php?section=rss&action=$1 [L]
RewriteRule ^Static/([A-Z][a-z][0-9]+)$ index.php?section=static&action=$1 [L]
RewriteRule ^User/([0-9]+)$ index.php?section=user&action=show&id=$1 [L]
RewriteRule ^User/([0-9]+)/(.*)$ index.php?section=user&action=show&id=$1 [L]

#-------------------------------------------------------------------------------
# MOSTLY ADMIN ACTIONS, NOT USED AS OFTEN AS ABOVE
#-------------------------------------------------------------------------------
RewriteRule ^Blog/([a-z]+)$ index.php?section=blog&action=$1&page=1 [L]
RewriteRule ^Blog/([a-z]+)/([A-Za-z0-9]+)$ index.php?section=blog&action=$1&id=$2&page=1 [L]
RewriteRule ^Content/([a-z]+)$ index.php?section=content&action=$1&page=1 [L]
RewriteRule ^Content/([a-z]+)/([0-9]+)$ index.php?section=content&action=$1&id=$2&page=1 [L]
RewriteRule ^Gallery/([a-z]+)$ index.php?section=gallery&action=$1 [L]
RewriteRule ^Gallery/upload/([0-9]+)/(.*)$ upload.php?section=gallery&id=$1&session_id=$2 [L]
RewriteRule ^Gallery/([a-z]+)/([0-9]+)$ index.php?section=gallery&action=$1&id=$2&page=1 [L]
RewriteRule ^Media/([a-z]+)$ index.php?section=media&action=$1 [L]
RewriteRule ^Media/destroy/(.*)$ index.php?section=media&action=destroy&file=$1 [L]
RewriteRule ^User/([a-z]+)/([0-9]+)$ index.php?section=user&action=$1&id=$2 [L]

#-------------------------------------------------------------------------------
# HIDE CONFIG
#-------------------------------------------------------------------------------
<Files "Config.inc.php">
  Order Allow,Deny
  Deny from All
</Files>

#-------------------------------------------------------------------------------
# CACHE OBJECTS
#-------------------------------------------------------------------------------
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresDefault A300
  ExpiresByType application/javascript A2592000
  ExpiresByType application/pdf A604800
  ExpiresByType application/x-javascript A2592000
  ExpiresByType application/x-shockwave-flash A604800
  ExpiresByType text/css A2592000
  ExpiresByType text/javascript A2592000
  ExpiresByType text/html A300
  ExpiresByType text/plain A604800
  ExpiresByType image/gif A604800
  ExpiresByType image/jpeg A604800
  ExpiresByType image/png A604800
  ExpiresByType image/x-icon A2592000
  ExpiresByType video/x-flv A604800

  AddType image/vnd.microsoft.icon .ico
  ExpiresByType image/vnd.microsoft.icon "access plus 3 months"
</IfModule>

<ifModule mod_headers.c>
  <filesMatch "\\.(ico|pdf|flv|jpg|jpeg|png|gif|swf)$">
    Header set Cache-Control "max-age=2592000, public"
  </filesMatch>
  <filesMatch "\\.(css)$">
    Header set Cache-Control "max-age=604800, public"
  </filesMatch>
  <filesMatch "\\.(js)$">
    Header set Cache-Control "max-age=216000, private"
  </filesMatch>
  <filesMatch "\\.(xml|txt)$">
    Header set Cache-Control "max-age=216000, public, must-revalidate"
  </filesMatch>
  <filesMatch "\\.(html|htm|php)$">
    Header set Cache-Control "max-age=1, private, must-revalidate"
  </filesMatch>
</ifModule>

#-------------------------------------------------------------------------------
# GZIP FILES
#-------------------------------------------------------------------------------
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

<ifModule mod_gzip.c>
  mod_gzip_on Yes
  mod_gzip_dechunk Yes
  mod_gzip_item_include file \.(html?|txt|css|js|php|pl)$
  mod_gzip_item_include handler ^cgi-script$
  mod_gzip_item_include mime ^text/.*
  mod_gzip_item_include mime ^application/x-javascript.*
  mod_gzip_item_exclude mime ^image/.*
  mod_gzip_item_exclude rspheader ^Content-Encoding:.*gzip.*
</ifModule>

#-------------------------------------------------------------------------------
# ETAG
#-------------------------------------------------------------------------------
FileETag MTime Size